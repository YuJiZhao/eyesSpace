这是我的个人网站，记录着我的生活与理念。我相信在互联网有属于自己的空间，心也就有了栖息地。瞳孔空间是我意识的体现，也会朝着我的理念发展下去。



里面还是有很多有意思的设计的，这里就不列出来了，就当做是彩蛋吧。



网站地址：[瞳孔空间](http://space.eyescode.top)



# 一：关于开发

技术栈：

- 前端：Vue3 + TS
- 后端：Spring Cloud + Spring Security + Quartz
- 数据库：MySQL + Redis
- 服务器：Nginx + Tomcat
- 消息队列：RabbitMQ



## 1.1：UI设计

前端UI是模仿了很多网站：

+ 整体设计主要是模仿Hexo的Butterfly主题样式，这也是我之前网站的主题。包括卡片式布局、顶部导航栏等
+ 说说列表参考了Artitalk、QQ好友动态
+ 博客列表参考了CSDN和Butterfly
+ 音乐界面参考了酷狗App
+ 视频界面参考了Bilibili（虽然一点也不像）



## 1.2：权限系统

权限系统采用策略模式实现，三类接口调用分属三种策略进行鉴权：

+ 客户端与服务端：采用双JWT机制，两个token过期时间不同，token1过期时间为token2一半。逻辑如下：
  + token1未过期：仍使用原token
  + token1过期而token2没过期：重新计算并刷新两个token
  + token2过期：返回用户信息过期，需重新登录
+ 服务端之间的调用：每个服务维护着一个密钥(为避免各服务更新不同步，会维护两个版本)，密钥由配置中心进行定时更新(详情见下文的配置中心设计)，服务调用时由Feign拦截器进行认证，不侵入业务代码。
+ 管理系统与服务端：自行脑补...



## 1.3：网关服务

由网关进行请求的预处理



网关采用基于IP的令牌桶限流，大概描述如下： 

+ 所有的请求在处理之前都需要拿到一个可用的令牌才会被处理； 
+ 根据限流大小，设置按照一定的速率往桶里添加令牌； 
+ 桶设置最大的放置令牌限制，当桶满时、新添加的令牌就被丢弃或者拒绝； 
+ 请求达到后首先要获取令牌桶中的令牌，拿着令牌才可以进行其他的业务逻辑，处理完业务逻辑之后，将令牌直接删除； 
+ 令牌桶有最低限额，当桶中的令牌达到最低限额的时候，请求处理完之后将不会删除令牌，以此保证足够的限流 



在网关使用拦截器对请求进行拦截，在把请求交给对应服务前会先进行鉴权，即获取请求相关信息后调用认证鉴权服务，如果认证鉴权服务返回无权限，则拒绝处理请求，反之会放行请求。



## 1.4：配置中心

每个服务均维护一个配置类，存储密钥等信息。由定时任务从数据库查询最新配置并更新。



如有配置变更，会在数据库执行插入操作而不是修改，由版本号确定是否为最新版本。



## 1.5：SEO优化

Nginx检测到请求来自于爬虫时，会将其重定向到Node服务，Node服务利用PhantomJS渲染对应页面的完整HTML结构返回，这是一种针对爬虫的SEO优化。



当发布博客和说说的时候，会提交SEO任务给消息队列。异步提交链接给各大搜索引擎



# 二：关于运维

项目运行在实体服务器上，从咸鱼淘来的n手Dell T110服务器，1核8G，1T500G。

+ 操作系统：Centos7
+ 前端：Nginx
+ 后端：Tomcat
+ MySQL、Redis、RabbitMQ：Docker部署



# 三：关于开源

前后端代码分别在front、serve分支



这里有两点需要说明：

+ 我的服务器是部署了Gitlab + Jenkins的持续集成环境，所以我开发时是用的Gitlab进行版本控制，因此Github上的代码并不是最新的，我只有在发大版本的时候才会来Github同步一下代码
+ 代码并非完全开源，管理系统的前端我没有开源，后端的认证鉴权服务没有开源。我是乐于开源的，但我得保证注册用户的数据安全。
